<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Travel Planner</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'muji-bg': '#FDFDF9',
                        'muji-text': '#333333',
                        'muji-accent': '#4A4A4A',
                        'muji-subtle': '#A9A9A9',
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #FDFDF9; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif; color: #333333; }
        html { scroll-behavior: smooth; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-muji-bg text-muji-text">

<div id="app" class="max-w-md mx-auto bg-muji-bg min-h-screen flex flex-col">

    <header class="p-4 pt-6 flex justify-end items-center">
        <div class="text-right">
            <span class="text-muji-subtle text-xs font-medium">ç›®å‰åŒ¯ç‡</span>
            <p class="text-muji-text font-semibold">1 KRW â‰ˆ {{ exchangeRateKRWtoHKD.toFixed(4) }} HKD</p>
        </div>
    </header>

    <main class="flex-grow overflow-y-auto no-scrollbar pb-28 px-4">
        
        <div v-if="activeTab === 'itinerary'">
            <div class="py-2 mb-4">
                <div class="flex space-x-3 overflow-x-auto no-scrollbar pb-2">
                    <button @click="selectDate('è¡Œå‰')" 
                            :class="selectedDate === 'è¡Œå‰' ? 'bg-muji-accent text-white' : 'bg-white border border-gray-200'"
                            class="flex-shrink-0 px-5 py-3 rounded-lg shadow-sm transition-colors duration-200">
                        <span class="font-bold text-sm">è¡Œå‰</span>
                    </button>
                    <button v-for="date in travelDates" :key="date" @click="selectDate(date)"
                            :class="selectedDate === date ? 'bg-muji-accent text-white' : 'bg-white border border-gray-200'"
                            class="flex-shrink-0 w-24 h-24 flex flex-col justify-center items-center rounded-lg shadow-sm transition-colors duration-200">
                        <span class="font-bold text-xl">{{ getDay(date) }}</span>
                        <span class="text-xs font-medium">Day {{ getDayNumber(date) }}</span>
                        <span class="text-xs text-muji-subtle mt-1" :class="{'text-white/70': selectedDate === date}">{{ getCityForDate(date) }}</span>
                    </button>
                </div>
            </div>

            <!-- å¤©æ°£å¡ç‰‡ (æ¨¡æ“¬) -->
            <div v-if="selectedDate !== 'è¡Œå‰' && currentWeather" class="bg-white rounded-xl p-4 flex items-center justify-between shadow-sm my-4 border border-gray-200">
                <div class="flex items-center">
                    <div class="text-3xl mr-3">{{ currentWeather.icon }}</div>
                    <div>
                        <p class="font-bold text-xl text-muji-text">{{ currentWeather.temp_max }}Â° / {{ currentWeather.temp_min }}Â° C</p>
                        <p class="text-sm text-muji-subtle">{{ currentWeather.description }}</p>
                    </div>
                </div>
                <div class="text-muji-subtle text-sm font-semibold px-3 py-1 rounded-full bg-gray-100">
                    ğŸ“ {{ currentCity }}
                </div>
            </div>

            <div class="flex justify-between items-center mt-6 mb-4">
                <h2 class="text-xl font-bold text-muji-text">{{ contentTitle }}</h2>
                <button @click="openAddItemModal" class="bg-muji-accent text-white font-bold py-2 px-4 rounded-lg shadow-sm">+ æ–°å¢</button>
            </div>

            <div v-if="selectedDate === 'è¡Œå‰'">
                <div v-if="preTripList.length === 0" class="bg-white rounded-xl p-6 text-center text-muji-subtle shadow-sm border border-gray-200">
                    <p>å¤ªæ£’äº†ï¼æ‰€æœ‰è¡Œå‰äº‹é …éƒ½å·²å®Œæˆï¼</p>
                </div>
                <div v-else v-for="(item, index) in preTripList" :key="index" class="bg-white rounded-xl p-4 mb-3 flex items-center justify-between shadow-sm border border-gray-200">
                    <div class="flex items-center">
                        <input type="checkbox" :id="'pre-trip-' + index" v-model="item.done" class="h-5 w-5 rounded border-gray-300 text-muji-accent focus:ring-muji-accent mr-4">
                        <label :for="'pre-trip-' + index" class="text-base" :class="{ 'line-through text-muji-subtle': item.done }">{{ item.task }}</label>
                    </div>
                    <button @click="removePreTripItem(index)" class="text-gray-400 hover:text-red-500">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd"></path></svg>
                    </button>
                </div>
            </div>

            <div v-else>
                <div v-if="filteredItinerary.length === 0" class="bg-white rounded-xl p-6 text-center text-muji-subtle shadow-sm border border-gray-200">
                    <p>é€™å¤©é‚„æ²’æœ‰å®‰æ’è¡Œç¨‹å–”ï¼</p>
                </div>
                <!-- è¡Œç¨‹åˆ—è¡¨ -->
                <div v-for="(item, index) in filteredItinerary" :key="item.id">
                    <div class="mb-4 bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden relative">
                        <!-- ç·¨è¼¯èˆ‡åˆªé™¤æŒ‰éˆ• -->
                        <div class="absolute top-3 right-3 flex space-x-2">
                             <button @click="openEditModal(item)" class="text-gray-400 hover:text-blue-500">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z"></path></svg>
                            </button>
                            <button @click="deleteItineraryItem(item.id)" class="text-gray-400 hover:text-red-500">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd"></path></svg>
                            </button>
                        </div>
                        
                        <div v-if="item.type === 'flight'" class="p-4 border-l-4 border-muji-accent">
                            <div class="flex justify-between items-start mb-3 pr-12">
                                <p class="font-bold text-lg">{{ item.time }}</p>
                                <span class="bg-gray-100 text-muji-subtle text-xs font-bold px-3 py-1 rounded-full">èˆªç­è³‡è¨Š</span>
                            </div>
                            <div class="flex items-center justify-between my-2">
                                <div class="text-center"><p class="text-2xl font-bold">{{ item.from }}</p><p class="text-xs text-muji-subtle">{{ item.from_full }}</p></div>
                                <div class="flex-grow flex flex-col items-center px-2"><span class="text-xl">âœˆï¸</span><div class="w-full border-t-2 border-dashed border-gray-300 mt-1"></div></div>
                                <div class="text-center"><p class="text-2xl font-bold">{{ item.to }}</p><p class="text-xs text-muji-subtle">{{ item.to_full }}</p></div>
                            </div>
                            <p class="text-muji-text font-semibold mt-2">{{ item.flightNumber }}</p>
                        </div>
                        <div v-else class="p-4 flex items-start">
                            <p class="font-bold text-lg w-20">{{ item.time }}</p>
                            <div class="flex-grow border-l-2 border-gray-200 pl-4 pr-12">
                                <p class="font-bold text-base text-muji-text">{{ item.activity }}</p>
                                <p v-if="item.location" class="text-sm text-muji-subtle mt-1">ğŸ“ {{ item.location }}</p>
                            </div>
                        </div>
                    </div>
                    <!-- æ¨¡æ“¬äº¤é€šæ™‚é–“ -->
                    <div v-if="index < filteredItinerary.length - 1 && item.location && filteredItinerary[index + 1].location" class="flex items-center justify-center my-2 text-muji-subtle">
                        <div class="w-px h-6 bg-gray-300"></div>
                        <span class="text-xs font-medium mx-3">{{ getSimulatedTravelTime(item.location, filteredItinerary[index + 1].location) }}</span>
                        <div class="w-px h-6 bg-gray-300"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åœ°åœ– -->
        <div v-if="activeTab === 'map'" class="space-y-3">
             <h2 class="text-xl font-bold text-muji-text mt-2 mb-4">è¡Œç¨‹åœ°é»ç¸½è¦½</h2>
             <div v-if="itineraryLocations.length === 0" class="bg-white rounded-xl p-6 text-center text-muji-subtle shadow-sm border border-gray-200">
                <p>è¡Œç¨‹è¡¨ä¸­æ²’æœ‰åœ°é»ï¼Œè«‹å…ˆæ–°å¢è¡Œç¨‹ã€‚</p>
            </div>
            <!-- ä¿®æ”¹å¾Œçš„åœ°åœ–åˆ—è¡¨é … -->
            <div v-else v-for="item in itineraryLocations" :key="item.id" class="bg-white rounded-xl p-4 flex justify-between items-center shadow-sm border border-gray-200">
                <div>
                    <p class="font-bold text-muji-text">{{ item.activity }}</p>
                    <p class="text-sm text-muji-subtle">{{ item.location }}</p>
                </div>
                <div class="flex items-center space-x-2">
                    <button @click="openEditModal(item)" class="p-2 text-gray-400 hover:text-blue-500 rounded-full hover:bg-gray-100 transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z"></path></svg>
                    </button>
                    <button @click="deleteItineraryItem(item.id)" class="p-2 text-gray-400 hover:text-red-500 rounded-full hover:bg-gray-100 transition">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd"></path></svg>
                    </button>
                    <a :href="getGoogleMapsUrl(item.location)" target="_blank" class="bg-muji-accent text-white px-4 py-2 rounded-lg hover:bg-black transition text-sm font-semibold shadow-sm">
                        å°èˆª
                    </a>
                </div>
            </div>
        </div>

        <!-- è¨˜å¸³ -->
        <div v-if="activeTab === 'accounting'" class="space-y-5">
            <div class="bg-white rounded-xl p-5 shadow-sm border border-gray-200">
                <div class="text-center mb-4">
                    <p class="text-sm text-muji-subtle">ç¸½æ”¯å‡º (å·²æ›ç®—ç‚º HKD)</p>
                    <p class="text-4xl font-bold tracking-tight text-muji-text my-1">HK$ {{ totalExpenses.toFixed(2) }}</p>
                </div>
                <div class="grid grid-cols-2 gap-4 text-center border-t border-gray-200 pt-4">
                    <div><p class="text-sm text-muji-subtle">å…¬æ•¸</p><p class="font-semibold text-muji-text">HK$ {{ totalPublicExpenses.toFixed(2) }}</p></div>
                    <div><p class="text-sm text-muji-subtle">ç§æ•¸</p><p class="font-semibold text-muji-text">HK$ {{ totalPrivateExpenses.toFixed(2) }}</p></div>
                    <div><p class="text-sm text-muji-subtle">ç¾é‡‘</p><p class="font-semibold text-muji-text">HK$ {{ totalCashExpenses.toFixed(2) }}</p></div>
                    <div><p class="text-sm text-muji-subtle">ä¿¡ç”¨å¡</p><p class="font-semibold text-muji-text">HK$ {{ totalCreditCardExpenses.toFixed(2) }}</p></div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-200">
                <h2 class="font-bold text-muji-text mb-3 text-lg">è¨˜ä¸€ç­†</h2>
                <input v-model="newExpense.description" placeholder="æ”¯å‡ºé …ç›®" class="w-full p-2 mb-2 bg-gray-50 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-muji-accent">
                <div class="flex space-x-2 mb-2">
                    <input v-model.number="newExpense.amount" type="number" placeholder="é‡‘é¡" class="w-2/3 p-2 bg-gray-50 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-muji-accent">
                    <select v-model="newExpense.currency" class="w-1/3 p-2 bg-gray-50 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-muji-accent">
                        <option value="KRW">KRW</option><option value="HKD">HKD</option>
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-4 my-3">
                    <div>
                        <label class="text-sm font-medium text-muji-subtle">é¡åˆ¥</label>
                        <div class="flex mt-1">
                            <button @click="newExpense.category = 'public'" :class="newExpense.category === 'public' ? 'bg-muji-accent text-white' : 'bg-gray-200'" class="flex-1 py-2 rounded-l-md text-sm">å…¬æ•¸</button>
                            <button @click="newExpense.category = 'private'" :class="newExpense.category === 'private' ? 'bg-muji-accent text-white' : 'bg-gray-200'" class="flex-1 py-2 rounded-r-md text-sm">ç§æ•¸</button>
                        </div>
                    </div>
                    <div>
                        <label class="text-sm font-medium text-muji-subtle">æ–¹å¼</label>
                        <div class="flex mt-1">
                            <button @click="newExpense.method = 'cash'" :class="newExpense.method === 'cash' ? 'bg-muji-accent text-white' : 'bg-gray-200'" class="flex-1 py-2 rounded-l-md text-sm">ç¾é‡‘</button>
                            <button @click="newExpense.method = 'credit'" :class="newExpense.method === 'credit' ? 'bg-muji-accent text-white' : 'bg-gray-200'" class="flex-1 py-2 rounded-r-md text-sm">ä¿¡ç”¨å¡</button>
                        </div>
                    </div>
                </div>
                <button @click="addExpense" class="w-full bg-muji-accent text-white py-2.5 rounded-md hover:bg-black transition font-semibold mt-2">æ–°å¢æ”¯å‡º</button>
            </div>
            <div class="flex justify-between items-center mb-4"><h2 class="font-bold text-muji-text text-xl">æ”¯å‡ºæ˜ç´°</h2></div>
            <div v-if="expenses.length === 0" class="bg-white rounded-xl p-6 text-center text-muji-subtle shadow-sm border border-gray-200"><p>æ²’æœ‰æ”¯å‡ºè¨˜éŒ„ã€‚</p></div>
            <div v-else v-for="expense in expenses" :key="expense.id" class="bg-white rounded-lg p-4 mb-3 flex justify-between items-center shadow-sm border border-gray-200">
                <div>
                    <p class="font-bold text-muji-text">{{ expense.description }}</p>
                    <div class="flex space-x-2 mt-1">
                        <span class="text-xs font-semibold px-2 py-0.5 rounded-full" :class="expense.category === 'public' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800'">{{ expense.category === 'public' ? 'å…¬æ•¸' : 'ç§æ•¸' }}</span>
                        <span class="text-xs font-semibold px-2 py-0.5 rounded-full bg-gray-100 text-gray-700">{{ expense.method === 'cash' ? 'ç¾é‡‘' : 'ä¿¡ç”¨å¡' }}</span>
                    </div>
                </div>
                <div class="text-right">
                    <p v-if="expense.currency === 'KRW'" class="font-bold text-red-600">- â‚© {{ expense.amount.toLocaleString() }}</p>
                    <p v-if="expense.currency === 'HKD'" class="font-bold text-red-600">- HK$ {{ expense.amount.toFixed(2) }}</p>
                    <p class="text-sm text-muji-subtle">(HK$ {{ expense.hkdAmount.toFixed(2) }})</p>
                    <button @click="removeExpense(expense.id)" class="text-xs text-gray-400 hover:text-red-500 mt-1">åˆªé™¤</button>
                </div>
            </div>
        </div>
        
        <div v-if="activeTab === 'info'" class="space-y-4">
             <h2 class="text-xl font-bold text-muji-text mt-2 mb-4">å¯¦ç”¨è³‡è¨Š</h2>
             <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-200">
                <h3 class="font-bold text-lg mb-2">åŒ¯ç‡è¨­å®š</h3>
                <div class="flex items-center space-x-2">
                    <span class="text-muji-subtle">1 KRW =</span>
                    <input v-model.number="exchangeRateKRWtoHKD" type="number" step="0.0001" class="flex-grow p-2 bg-gray-50 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-muji-accent">
                    <span class="text-muji-subtle">HKD</span>
                </div>
                <p class="text-xs text-muji-subtle mt-2">è«‹è¼¸å…¥éŸ“å…ƒå°æ¸¯å¹£çš„åŒ¯ç‡ï¼Œä¾‹å¦‚ï¼š0.0058</p>
            </div>
            <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-200">
                <h3 class="font-bold text-lg mb-2">å‚™å¿˜éŒ„</h3>
                <textarea class="w-full h-32 p-2 bg-gray-50 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-muji-accent" placeholder="è¨˜éŒ„ä¸€äº›é‡è¦äº‹é …..."></textarea>
            </div>
        </div>
    </main>

    <!-- Modal å€åŸŸ -->
    <!-- æ–°å¢é …ç›® Modal -->
    <div v-if="isAddModalOpen" class="fixed inset-0 bg-black/30 z-40 flex items-center justify-center p-4" @click.self="closeAddModal">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-sm p-6">
            <h3 class="font-bold text-xl mb-4 text-muji-text">æ–°å¢é …ç›®</h3>
            <div v-if="selectedDate === 'è¡Œå‰'">
                <h4 class="font-semibold text-muji-subtle mb-2">æ–°å¢å¾…è¾¦äº‹é …</h4>
                <input v-model="newPreTripTask" @keyup.enter="addPreTripItem" placeholder="ä¾‹å¦‚ï¼šè³¼è²·æ—…éŠä¿éšª" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-muji-accent mb-4">
                <button @click="addPreTripItem" class="w-full bg-muji-accent text-white py-3 rounded-md font-semibold">ç¢ºèªæ–°å¢</button>
            </div>
            <div v-else>
                <div class="mb-4"><label class="font-semibold text-muji-subtle">é …ç›®é¡å‹</label><select v-model="newItem.type" class="w-full p-3 mt-1 bg-gray-100 border border-gray-300 rounded-md"><option value="activity">ä¸€èˆ¬æ´»å‹•</option><option value="flight">èˆªç­</option></select></div>
                <div v-if="newItem.type === 'activity'"><input v-model="newItem.time" type="time" class="w-full p-3 mb-2 border border-gray-300 rounded-md"><input v-model="newItem.activity" placeholder="æ´»å‹•åç¨±" class="w-full p-3 mb-2 border border-gray-300 rounded-md"><input v-model="newItem.location" placeholder="åœ°é»/åœ°å€" class="w-full p-3 mb-4 border border-gray-300 rounded-md"></div>
                <div v-if="newItem.type === 'flight'"><input v-model="newItem.time" type="time" placeholder="èµ·é£›æ™‚é–“" class="w-full p-3 mb-2 border border-gray-300 rounded-md"><input v-model="newItem.flightNumber" placeholder="èˆªç­è™Ÿç¢¼ (e.g., KE608)" class="w-full p-3 mb-2 border border-gray-300 rounded-md"><div class="flex space-x-2 mb-2"><input vmodel="newItem.from" placeholder="å‡ºç™¼ (e.g., HKG)" class="w-1/2 p-3 border border-gray-300 rounded-md"><input v-model="newItem.to" placeholder="æŠµé” (e.g., ICN)" class="w-1/2 p-3 border border-gray-300 rounded-md"></div><div class="flex space-x-2 mb-4"><input vmodel="newItem.from_full" placeholder="å‡ºç™¼æ©Ÿå ´å…¨å" class="w-1/2 p-3 border border-gray-300 rounded-md"><input v-model="newItem.to_full" placeholder="æŠµé”æ©Ÿå ´å…¨å" class="w-1/2 p-3 border border-gray-300 rounded-md"></div></div>
                <button @click="addItineraryItem" class="w-full bg-muji-accent text-white py-3 rounded-md font-semibold">ç¢ºèªæ–°å¢</button>
            </div>
        </div>
    </div>
    <!-- ç·¨è¼¯é …ç›® Modal -->
    <div v-if="isEditModalOpen" class="fixed inset-0 bg-black/30 z-40 flex items-center justify-center p-4" @click.self="closeEditModal">
        <div v-if="editingItem" class="bg-white rounded-xl shadow-lg w-full max-w-sm p-6">
            <h3 class="font-bold text-xl mb-4 text-muji-text">ç·¨è¼¯é …ç›®</h3>
            <div>
                <div class="mb-4"><label class="font-semibold text-muji-subtle">é …ç›®é¡å‹</label><select v-model="editingItem.type" class="w-full p-3 mt-1 bg-gray-100 border border-gray-300 rounded-md"><option value="activity">ä¸€èˆ¬æ´»å‹•</option><option value="flight">èˆªç­</option></select></div>
                <div v-if="editingItem.type === 'activity'"><input v-model="editingItem.time" type="time" class="w-full p-3 mb-2 border border-gray-300 rounded-md"><input v-model="editingItem.activity" placeholder="æ´»å‹•åç¨±" class="w-full p-3 mb-2 border border-gray-300 rounded-md"><input vmodel="editingItem.location" placeholder="åœ°é»/åœ°å€" class="w-full p-3 mb-4 border border-gray-300 rounded-md"></div>
                <div v-if="editingItem.type === 'flight'"><input v-model="editingItem.time" type="time" placeholder="èµ·é£›æ™‚é–“" class="w-full p-3 mb-2 border border-gray-300 rounded-md"><input v-model="editingItem.flightNumber" placeholder="èˆªç­è™Ÿç¢¼" class="w-full p-3 mb-2 border border-gray-300 rounded-md"><div class="flex space-x-2 mb-2"><input vmodel="editingItem.from" placeholder="å‡ºç™¼" class="w-1/2 p-3 border border-gray-300 rounded-md"><input v-model="editingItem.to" placeholder="æŠµé”" class="w-1/2 p-3 border border-gray-300 rounded-md"></div><div class="flex space-x-2 mb-4"><input vmodel="editingItem.from_full" placeholder="å‡ºç™¼æ©Ÿå ´å…¨å" class="w-1/2 p-3 border border-gray-300 rounded-md"><input v-model="editingItem.to_full" placeholder="æŠµé”æ©Ÿå ´å…¨å" class="w-1/2 p-3 border border-gray-300 rounded-md"></div></div>
                <button @click="updateItineraryItem" class="w-full bg-muji-accent text-white py-3 rounded-md font-semibold">å„²å­˜è®Šæ›´</button>
            </div>
        </div>
    </div>


    <nav class="bg-white fixed bottom-0 left-0 right-0 max-w-md mx-auto flex justify-around border-t border-gray-200">
        <button @click="activeTab = 'itinerary'" class="flex-1 py-3 flex flex-col items-center justify-center transition-colors" :class="activeTab === 'itinerary' ? 'text-muji-accent' : 'text-muji-subtle'"><svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 00-1 1v1a1 1 0 002 0V3a1 1 0 00-1-1zM4 4a1 1 0 00-1 1v1a1 1 0 002 0V5a1 1 0 00-1-1zm12 0a1 1 0 00-1 1v1a1 1 0 002 0V5a1 1 0 00-1-1zM4 10a1 1 0 00-1 1v1a1 1 0 002 0v-1a1 1 0 00-1-1zm12 0a1 1 0 00-1 1v1a1 1 0 002 0v-1a1 1 0 00-1-1zM10 16a1 1 0 00-1 1v1a1 1 0 002 0v-1a1 1 0 00-1-1zM4 16a1 1 0 00-1 1v1a1 1 0 002 0v-1a1 1 0 00-1-1zm12 0a1 1 0 00-1 1v1a1 1 0 002 0v-1a1 1 0 00-1-1zM10 6a4 4 0 100 8 4 4 0 000-8z"></path></svg><span class="text-xs font-medium">è¡Œç¨‹</span></button>
        <button @click="activeTab = 'map'" class="flex-1 py-3 flex flex-col items-center justify-center transition-colors" :class="activeTab === 'map' ? 'text-muji-accent' : 'text-muji-subtle'"><svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path></svg><span class="text-xs font-medium">åœ°åœ–</span></button>
        <button @click="activeTab = 'accounting'" class="flex-1 py-3 flex flex-col items-center justify-center transition-colors" :class="activeTab === 'accounting' ? 'text-muji-accent' : 'text-muji-subtle'"><svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 20 20"><path d="M8.433 7.418c.158-.103.346-.196.567-.267v1.698a2.5 2.5 0 00-.567-.267zM11.567 8.582v-1.698c.22.07.408.164.567.267a2.5 2.5 0 00-.567 1.431z"></path><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.5 4.5 0 00-1.876.902C6.016 6.7 5 7.9 5 9.5a2.5 2.5 0 002.5 2.5h.577c.252.39.629.694 1.055.872a.5.5 0 00.34.023c.283-.06.566-.14.832-.245.266-.105.52-.233.758-.383a.5.5 0 00.247-.411V9.5a2.5 2.5 0 00-2.5-2.5h-.577a4.5 4.5 0 00-1.544.332V5z" clip-rule="evenodd"></path></svg><span class="text-xs font-medium">è¨˜å¸³</span></button>
        <button @click="activeTab = 'info'" class="flex-1 py-3 flex flex-col items-center justify-center transition-colors" :class="activeTab === 'info' ? 'text-muji-accent' : 'text-muji-subtle'"><svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="text-xs font-medium">è³‡è¨Š</span></button>
    </nav>

</div>

<script>
    const { createApp, ref, reactive, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            // --- ç‹€æ…‹ç®¡ç† ---
            const activeTab = ref('itinerary');
            const selectedDate = ref('è¡Œå‰');
            const isAddModalOpen = ref(false);
            const isEditModalOpen = ref(false);
            const editingItem = ref(null);

            // --- æ•¸æ“šæ¨¡å‹ ---
            const exchangeRateKRWtoHKD = ref(0.0058);
            const preTripList = ref([
                { task: 'é è¨‚é¦–çˆ¾é…’åº—', done: true },
                { task: 'é è¨‚æ¿Ÿå·é…’åº—', done: true },
                { task: 'è³¼è²·æ—…éŠä¿éšª', done: false },
                { task: 'ç§Ÿå€Ÿ Wifi Egg', done: false },
            ]);
            const itinerary = ref([
                { id: 1, date: '2024-12-24', time: '14:30', type: 'flight', city: 'é¦–çˆ¾', flightNumber: 'KE608', from: 'HKG', from_full: 'é¦™æ¸¯åœ‹éš›æ©Ÿå ´', to: 'ICN', to_full: 'ä»å·åœ‹éš›æ©Ÿå ´', location: null },
                { id: 2, date: '2024-12-24', time: '20:00', type: 'activity', city: 'é¦–çˆ¾', activity: 'æ™šé¤ï¼šæ˜æ´æ ¡æ´é¤ƒå­', location: 'Myeong-dong, Seoul' },
                { id: 3, date: '2024-12-25', time: '10:00', type: 'activity', city: 'é¦–çˆ¾', activity: 'åƒè§€æ™¯ç¦å®®', location: 'é¦–çˆ¾ç‰¹åˆ¥å¸‚é˜è·¯å€ç¤¾ç¨·è·¯161' },
                { id: 4, date: '2024-12-25', time: '19:00', type: 'activity', city: 'é¦–çˆ¾', activity: 'è–èª•ç‡ˆé£¾ @ The Hyundai Seoul', location: 'The Hyundai Seoul, Yeouido' },
                { id: 5, date: '2024-12-26', time: '11:00', type: 'activity', city: 'é¦–çˆ¾', activity: 'åŒ—æ‘éŸ“å±‹æ‘æ•£æ­¥', location: 'Bukchon Hanok Village, Seoul' },
                { id: 6, date: '2024-12-26', time: '15:00', type: 'activity', city: 'é¦–çˆ¾', activity: 'å»£è—å¸‚å ´å°åƒ', location: 'Gwangjang Market, Seoul' },
                { id: 7, date: '2024-12-27', time: '11:00', type: 'activity', city: 'é¦–çˆ¾', activity: 'é¦–çˆ¾é…’åº— Check-out', location: 'Hotel in Seoul' },
                { id: 8, date: '2024-12-27', time: '14:00', type: 'flight', city: 'æ¿Ÿå·', flightNumber: '7C123', from: 'GMP', from_full: 'é‡‘æµ¦åœ‹éš›æ©Ÿå ´', to: 'CJU', to_full: 'æ¿Ÿå·åœ‹éš›æ©Ÿå ´', location: null },
                { id: 9, date: '2024-12-27', time: '16:30', type: 'activity', city: 'æ¿Ÿå·', activity: 'æ¿Ÿå·é…’åº— Check-in', location: 'Hotel in Jeju' },
                { id: 10, date: '2024-12-28', time: '09:30', type: 'activity', city: 'æ¿Ÿå·', activity: 'åŸå±±æ—¥å‡ºå³°', location: 'Seongsan Ilchulbong' },
                { id: 11, date: '2024-12-28', time: '14:00', type: 'activity', city: 'æ¿Ÿå·', activity: 'æ¶‰åœ°å¯æ”¯æ•£æ­¥', location: 'Seopjikoji' },
                { id: 12, date: '2024-12-29', time: '10:00', type: 'activity', city: 'æ¿Ÿå·', activity: 'O\'sulloc é›ªç¶ èŒ¶åšç‰©é¤¨', location: 'Osulloc Tea Museum' },
                { id: 13, date: '2024-12-30', time: '11:00', type: 'activity', city: 'æ¿Ÿå·', activity: 'æ¿Ÿå·å¸‚å€è³¼ç‰©', location: 'Jeju City' },
                { id: 14, date: '2024-12-31', time: '15:00', type: 'flight', city: 'æ¿Ÿå·', flightNumber: 'KE1234', from: 'CJU', from_full: 'æ¿Ÿå·åœ‹éš›æ©Ÿå ´', to: 'HKG', to_full: 'é¦™æ¸¯åœ‹éš›æ©Ÿå ´', location: null },
            ]);
            const expenses = ref([
                { id: 1, description: 'æ˜æ´æ™šé¤', amount: 35000, currency: 'KRW', hkdAmount: 203, category: 'public', method: 'credit' },
                { id: 2, description: 'å’–å•¡', amount: 6000, currency: 'KRW', hkdAmount: 34.8, category: 'private', method: 'cash' },
            ]);
            
            // --- æ¨¡æ“¬å¤©æ°£æ•¸æ“š (Mock Data) ---
            const weatherData = {
                'é¦–çˆ¾': [
                    { date: '2024-12-24', temp_min: -5, temp_max: 2, description: 'æ™´æ™‚å¤šé›²', icon: 'â›…ï¸' },
                    { date: '2024-12-25', temp_min: -6, temp_max: 1, description: 'æ™´å¤©', icon: 'â˜€ï¸' },
                    { date: '2024-12-26', temp_min: -4, temp_max: 3, description: 'é™°å¤©æœ‰é›ª', icon: 'â„ï¸' },
                    { date: '2024-12-27', temp_min: -3, temp_max: 4, description: 'å¤šé›²', icon: 'â˜ï¸' },
                ],
                'æ¿Ÿå·': [
                    { date: '2024-12-27', temp_min: 2, temp_max: 8, description: 'æœ‰é™£é›¨', icon: 'ğŸŒ¦ï¸' },
                    { date: '2024-12-28', temp_min: 3, temp_max: 9, description: 'å¤šé›²æ™‚æ™´', icon: 'â›…ï¸' },
                    { date: '2024-12-29', temp_min: 4, temp_max: 10, description: 'æ™´å¤©', icon: 'â˜€ï¸' },
                    { date: '2024-12-30', temp_min: 5, temp_max: 11, description: 'å¤šé›²æœ‰é¢¨', icon: 'ğŸŒ¬ï¸' },
                    { date: '2024-12-31', temp_min: 4, temp_max: 9, description: 'å¤šé›²', icon: 'â˜ï¸' },
                ]
            };
            
            const newItem = reactive({ date: '', time: '', type: 'activity', city: '', activity: '', location: '', flightNumber: '', from: '', to: '', from_full: '', to_full: '' });
            const newPreTripTask = ref('');
            const newExpense = reactive({ description: '', amount: null, currency: 'KRW', category: 'private', method: 'cash' });

            // --- è¨ˆç®—å±¬æ€§ ---
            const contentTitle = computed(() => (selectedDate.value === 'è¡Œå‰') ? 'è¡Œå‰æ¸…å–®' : `Day ${getDayNumber(selectedDate.value)} è¡Œç¨‹å®‰æ’`);
            const travelDates = computed(() => Array.from(new Set(itinerary.value.map(item => item.date))).sort());
            const filteredItinerary = computed(() => itinerary.value.filter(item => item.date === selectedDate.value).sort((a, b) => a.time.localeCompare(b.time)));
            const currentCity = computed(() => filteredItinerary.value.length > 0 ? filteredItinerary.value[0].city : '');
            const itineraryLocations = computed(() => itinerary.value.filter(item => item.location));
            const totalExpenses = computed(() => expenses.value.reduce((sum, expense) => sum + (expense.hkdAmount || 0), 0));
            const totalPublicExpenses = computed(() => expenses.value.filter(e => e.category === 'public').reduce((sum, e) => sum + e.hkdAmount, 0));
            const totalPrivateExpenses = computed(() => expenses.value.filter(e => e.category === 'private').reduce((sum, e) => sum + e.hkdAmount, 0));
            const totalCashExpenses = computed(() => expenses.value.filter(e => e.method === 'cash').reduce((sum, e) => sum + e.hkdAmount, 0));
            const totalCreditCardExpenses = computed(() => expenses.value.filter(e => e.method === 'credit').reduce((sum, e) => sum + e.hkdAmount, 0));
            
            const currentWeather = computed(() => {
                if (selectedDate.value === 'è¡Œå‰' || !currentCity.value) return null;
                const cityWeather = weatherData[currentCity.value];
                if (!cityWeather) return null;
                return cityWeather.find(w => w.date === selectedDate.value);
            });

            // --- æ–¹æ³• ---
            const selectDate = (date) => { selectedDate.value = date; };
            const getDay = (dateString) => new Date(dateString).getDate();
            const getDayNumber = (dateString) => travelDates.value.indexOf(dateString) + 1;
            const getCityForDate = (dateString) => (itinerary.value.find(item => item.date === dateString) || {}).city || '';

            const openAddModal = () => { resetNewItem(); isAddModalOpen.value = true; };
            const closeAddModal = () => { isAddModalOpen.value = false; };
            const openEditModal = (item) => {
                editingItem.value = JSON.parse(JSON.stringify(item));
                isEditModalOpen.value = true;
            };
            const closeEditModal = () => { isEditModalOpen.value = false; editingItem.value = null; };

            const resetNewItem = () => { Object.assign(newItem, { date: '', time: '', type: 'activity', city: '', activity: '', location: '', flightNumber: '', from: '', to: '', from_full: '', to_full: '' }); };
            const addPreTripItem = () => { if (newPreTripTask.value.trim()) { preTripList.value.push({ task: newPreTripTask.value.trim(), done: false }); closeAddModal(); } };
            const removePreTripItem = (index) => { preTripList.value.splice(index, 1); };
            const addItineraryItem = () => {
                if (!selectedDate.value || selectedDate.value === 'è¡Œå‰') return alert('è«‹å…ˆé¸æ“‡ä¸€å€‹å…·é«”çš„è¡Œç¨‹æ—¥æœŸï¼');
                const itemToAdd = { ...newItem, id: Date.now(), date: selectedDate.value, city: getCityForDate(selectedDate.value) };
                itinerary.value.push(itemToAdd);
                closeAddModal();
            };
            const updateItineraryItem = () => {
                const index = itinerary.value.findIndex(item => item.id === editingItem.value.id);
                if (index !== -1) {
                    itinerary.value[index] = { ...editingItem.value };
                }
                closeEditModal();
            };
            const deleteItineraryItem = (itemId) => {
                if (window.confirm('ç¢ºå®šè¦åˆªé™¤æ­¤è¡Œç¨‹å—ï¼Ÿ')) {
                    itinerary.value = itinerary.value.filter(item => item.id !== itemId);
                }
            };
            
            const getSimulatedTravelTime = (location1, location2) => {
                const hash = (s) => s.split('').reduce((a,b)=>{a=((a<<5)-a)+b.charCodeAt(0);return a&a},0);
                const time = Math.abs(hash(location1 + location2)) % 30 + 15;
                return `ğŸš‡ ç´„ ${time} åˆ†é˜`;
            };

            const getGoogleMapsUrl = (location) => `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(location)}`;

            const addExpense = () => {
                if (newExpense.description && newExpense.amount > 0) {
                    const amount = parseFloat(newExpense.amount);
                    const hkdAmount = newExpense.currency === 'KRW' ? amount * exchangeRateKRWtoHKD.value : amount;
                    expenses.value.unshift({ ...newExpense, id: Date.now(), amount, hkdAmount });
                    Object.assign(newExpense, { description: '', amount: null, currency: 'KRW', category: 'private', method: 'cash' });
                } else { alert('è«‹å¡«å¯«æ”¯å‡ºé …ç›®å’Œæ­£ç¢ºçš„é‡‘é¡ï¼'); }
            };
            const removeExpense = (id) => { expenses.value = expenses.value.filter(e => e.id !== id); };

            const saveData = () => {
                localStorage.setItem('travel_planner_data_v4', JSON.stringify({
                    exchangeRate: exchangeRateKRWtoHKD.value,
                    preTripList: preTripList.value,
                    itinerary: itinerary.value,
                    expenses: expenses.value
                }));
            };
            const loadData = () => {
                const savedData = localStorage.getItem('travel_planner_data_v4');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    exchangeRateKRWtoHKD.value = data.exchangeRate || 0.0058;
                    preTripList.value = data.preTripList || [];
                    itinerary.value = data.itinerary || [];
                    expenses.value = data.expenses || [];
                }
            };

            onMounted(() => {
                loadData();
            });
            watch([exchangeRateKRWtoHKD, preTripList, itinerary, expenses], saveData, { deep: true });

            return {
                activeTab, exchangeRateKRWtoHKD, selectedDate, travelDates, filteredItinerary, contentTitle, currentCity, selectDate, getDay, getDayNumber, getCityForDate,
                preTripList, addPreTripItem, removePreTripItem,
                isAddModalOpen, openAddModal, closeAddModal, newItem, newPreTripTask, addItineraryItem,
                isEditModalOpen, editingItem, openEditModal, closeEditModal, updateItineraryItem, deleteItineraryItem,
                itineraryLocations, getGoogleMapsUrl,
                expenses, newExpense, totalExpenses, totalPublicExpenses, totalPrivateExpenses, totalCashExpenses, totalCreditCardExpenses, addExpense, removeExpense,
                currentWeather, getSimulatedTravelTime
            };
        }
    }).mount('#app');
</script>

</body>
</html>